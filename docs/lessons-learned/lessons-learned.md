# Lessons Learned

> **Regel:** Maximal 70 Einträge. Bei Überschreitung die ältesten in `archiv/<kategorie>/` verschieben.
> **PFLICHT:** JEDER Fehler wird hier dokumentiert, egal wie klein. Fehler dürfen NIEMALS ein zweites Mal auftreten.

Archivkategorien: `netzwerk/`, `terminal/`, `ui/`, `performance/`, `security/`, `migration/`, `allgemein/`

---

| # | Datum | Kategorie | Beschreibung |
|---|-------|-----------|-------------|
| 1 | 2026-02-10 | terminal | **node-pty + Electron: Native Module Builds** - node-pty@1.1.0 brauchte winpty (GetCommitHash.bat Fehler). node-pty@1.2.0-beta.11 (ConPTY-only) scheiterte an Spectre-Mitigation. Lösung: `scripts/rebuild-pty.js` patcht binding.gyp automatisch vor electron-rebuild. Lehre: Native Electron-Module können plattformspezifische Build-Probleme haben. |
| 2 | 2026-02-10 | allgemein | **Session-Save im before-quit muss synchron sein** - Electrons `before-quit` wartet NICHT auf async Operationen. Lösung: `zlib.gzipSync()` + `fs.writeFileSync()`. Lehre: Electron Lifecycle-Events sind synchron — für Cleanup immer synchrone APIs verwenden. |
| 3 | 2026-02-10 | ui | **Chromium file:// blockiert Module Workers** - pdf.js Worker (.mjs) → Module Worker → Chromium blockiert von file:// URLs. Lösung: Worker per Blob-URL laden, `export{}` entfernen. Lehre: In Electron/Tauri niemals Module Workers verwenden. |
| 4 | 2026-02-10 | allgemein | **Node.js Buffer.buffer enthält Pool-Daten** - `buffer.buffer` ist der unterliegende ArrayBuffer des GESAMTEN Pools. `new Uint8Array(buffer.buffer)` enthält Müll-Daten. Lösung: `.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength)`. |
| 5 | 2026-02-11 | allgemein | **Electron Admin-Elevation: Single-Instance Lock Race Condition** - `app.quit()` ist ASYNC, `requestSingleInstanceLock()` Race Condition. Lösung: `releaseSingleInstanceLock()` VOR Spawn + `app.exit(0)` statt `app.quit()` + `execFileAsync` statt `execAsync`. |
| 6 | 2026-02-16 | migration | **Migration = JEDE Funktion prüfen** - 31 Funktionen als Stubs belassen nach Electron→Tauri v2 Migration. Lehre: Per Grep nach `stub: true`, `json!([])`, `json!(null)` suchen. Migration ist NICHT fertig wenn die App startet — erst wenn JEDE Funktion echte Daten liefert. |
| 7 | 2026-02-16 | allgemein | **Bei User-Fehlermeldung ganzheitlich prüfen** - NIEMALS nur den gemeldeten Fall fixen. IMMER prüfen ob weitere Funktionen betroffen sind. Der User darf NIEMALS zweimal auf dasselbe Problem hinweisen. |
| 8 | 2026-02-17 | migration | **Base64-Dekodierung für Tauri-IPC** - Tauri serialisiert Binärdaten als Base64-JSON-Strings. Electron konnte ArrayBuffers direkt übergeben. `new Uint8Array(base64String)` ergibt leeres Array. Fix: `atob()` + charCode-Schleife. Lehre: Jeder Datentyp-Transfer zwischen Rust↔JS muss einzeln verifiziert werden. |
| 9 | 2026-02-17 | terminal | **Terminal Piped I/O: Kein PTY = kein interaktives Terminal** - `std::process::Command` mit `Stdio::piped()` ist KEIN PTY. Backspace, Umlaute, Pfeiltasten, Tab-Completion funktionieren NICHT. PowerShell hat kein PSReadLine im Non-PTY-Modus. Lösung: `portable-pty` Crate für ConPTY. Quick-Fix: UTF-8 Encoding per stdin + Input-Buffer im Frontend. |
| 10 | 2026-02-17 | terminal | **Windows PowerShell Encoding: cp437/cp850 statt UTF-8** - Terminal startet PowerShell ohne UTF-8-Encoding-Initialisierung. `from_utf8_lossy()` liest cp850-Bytes → Umlaute kaputt. Fix: `[Console]::OutputEncoding = [Text.Encoding]::UTF8` per stdin nach Spawn senden. CMD: `chcp 65001`. |
| 11 | 2026-02-17 | terminal | **Set-Location sichtbar im Terminal** - `changeCwd()` sendet rohen `Set-Location`-Befehl an stdin. In Non-PTY-Modus kein sauberer Prompt. Fix: Terminal bei cwd-Wechsel neu starten statt Set-Location senden. |
| 12 | 2026-02-17 | netzwerk | **ARP-Table Race Condition** - ARP-Tabelle wird VOR dem Ping-Sweep gelesen. Neue Geräte nach dem Ping haben keinen ARP-Eintrag. Fix: ARP-Table NACH dem Ping-Sweep nochmals lesen. |
| 13 | 2026-02-17 | netzwerk | **SSDP liefert 0 Modelle** - Log zeigt "0 mit Modell-Info" bei jedem Scan. Ursache: Mögliches Firewall-Blocking von SSDP-Multicast (Port 1900) oder alle Geräte im Netzwerk unterstützen kein UPnP. friendlyName wird im Frontend ignoriert. Fix: friendlyName anzeigen + vendor in deviceLabel einbauen. |
| 14 | 2026-02-17 | netzwerk | **OUI-Datenbank wird nie heruntergeladen** - `updateOUIDatabase()` existiert im Backend aber wird NIRGENDS im Frontend aufgerufen. Nur 200 statische OUI-Einträge statt 30.000+. Fix: Automatischer Download beim ersten Netzwerk-Scan wenn keine oui.txt vorhanden. |
| 15 | 2026-02-17 | netzwerk | **Firmen werden nicht angezeigt** - `getPollingData()` wird nur EINMAL aufgerufen. `resolve_ips_background()` läuft async und braucht 8-10s, aber danach wird `getPollingData()` nie wieder aufgerufen. Ergebnis: IP-Cache wird befüllt aber Frontend sieht die Daten nie. Fix: Periodisch `getPollingData()` aufrufen oder zweiten Refresh nach 10s einplanen. |
| 16 | 2026-02-17 | netzwerk | **classify_device() gibt nur generische Labels** - "Drucker" statt "Brother Drucker". Vendor-Info ist bekannt aber wird nicht in deviceLabel eingebaut. Fix: Vendor in Label integrieren wenn möglich. |
| 17 | 2026-02-17 | allgemein | **Log-Dateien ohne Rotation** - 26 Log-Dateien in docs/logs/, kein automatisches Aufräumen. Fix: Beim App-Start älteste Logs über Maximum (20) löschen. |
| 18 | 2026-02-17 | allgemein | **Bug-Drift durch oberflächliche Analyse** - Fixes eingeführt die neue Bugs erzeugen (z.B. detect_os() zeigt "Windows" in Modell-Spalte). Lehre: JEDE Änderung muss den vollständigen Datenfluss Frontend→Backend→Frontend prüfen. NIE nur eine Seite ändern. |
| 19 | 2026-02-17 | ui | **SVG-Icons ohne CSS = unsichtbar** - SVG-Icons im Explorer hinzugefügt aber CSS für Größe/Farbe muss gleichzeitig erstellt werden. Lehre: Frontend-Änderungen IMMER als Gesamtpaket (HTML + JS + CSS) testen. |
| 20 | 2026-02-17 | netzwerk | **MAC-Adressen: Passiver Scan ohne Fallback** - Im passiven Scan fehlt der `|| '—'` Fallback für leere MAC-Adressen. Ergebnis: Leere Tabellenzellen. |
| 21 | 2026-02-17 | security | **withGlobalTauri: true = Sicherheitslücke** - `tauri.conf.json` hatte `withGlobalTauri: true`. Das erlaubt eingeschleustem JS-Code direkten Zugriff auf `window.__TAURI__` IPC. Fix: Auf `false` setzen, Zugriff nur über `tauri-bridge.js`. |
| 22 | 2026-02-17 | security | **Context-Menu Event-Name Mismatch** - Backend emittiert `context-menu-request`, Bridge hört auf `context-menu-action`. Kontextmenü funktioniert nie. Fix: Event-Namen synchronisieren. Lehre: Bei IPC-Events IMMER beide Seiten prüfen. |
| 23 | 2026-02-17 | security | **Privacy-Settings: REG_DWORD statt REG_SZ** - `CapabilityAccessManager\ConsentStore` (app-diagnose, standort-zugriff) speichert "Allow"/"Deny" als REG_SZ-String. Code schrieb REG_DWORD 0/1 → Wert wird ignoriert, Einstellung bleibt unverändert. Fix: REG_SZ mit korrekten String-Werten. |
| 24 | 2026-02-17 | allgemein | **Autostart: Substring-Match trifft RunOnce** - `locationLabel.contains("HKCU\\Run")` matcht auch "HKCU\RunOnce". Spezifischere Patterns MÜSSEN zuerst geprüft werden. Fix: RunOnce-Check VOR Run-Check in if/else-Kette. |
| 25 | 2026-02-17 | netzwerk | **detect_os: Byte-Index auf lowercase String** - `ssdp_server[start..]` nutzte Index von `server_lower` → potentieller Panic bei Non-ASCII. Fix: Konsistent `server_lower` verwenden. |
| 26 | 2026-02-17 | security | **resolve_ips: Keine IP-Validierung** - IPs vom Frontend wurden unvalidiert in PowerShell-Befehle eingesetzt → Command-Injection-Risiko. Fix: `validate_ip()` vor Verwendung aufrufen. |
| 27 | 2026-02-17 | netzwerk | **get_smb_shares: Falscher PowerShell-Command** - `Get-SmbConnection` zeigt nur aktive Verbindungen, nicht alle Shares auf einem Server. Fix: Fallback auf `net view \\server` wenn keine Verbindungen gefunden. |
| 28 | 2026-02-17 | ui | **Views ohne destroy() = Memory Leak** - NetworkView, PrivacyView, SmartView, SoftwareAuditView, SystemScoreView hatten keine `destroy()` Methode. Intervalle und Chart-Instanzen werden nie aufgeräumt. Fix: `destroy()` in allen Views implementieren. Lehre: JEDE View braucht `destroy()`. |
| 29 | 2026-02-17 | ui | **preview.js escapeHtml ohne Quote-Escaping** - Lokale `escapeHtml()` hatte kein `"` → `&quot;` Escaping. Potential für XSS bei Dateinamen mit Anführungszeichen. Fix: `&quot;` Escaping ergänzt. |
| 30 | 2026-02-17 | allgemein | **Umlaute in PowerShell-Strings** - `get_privacy_recommendations` nutzte ae/oe/ue statt ä/ö/ü. Lehre: Rust-Quellcode ist UTF-8, PowerShell-Strings in `r#"..."#` können echte Umlaute enthalten. |
| 31 | 2026-02-17 | netzwerk | **OUI-Download nie vom Frontend getriggert** - `updateOUIDatabase()` in `tauri-bridge.js` vorhanden aber nie aufgerufen. Fix: Automatischer Download bei erstem Active-Scan. Lehre: Bridge-Methoden MÜSSEN im Frontend verwendet werden. |
| 32 | 2026-02-17 | terminal | **terminal_open_external ohne Fallback** - Nur Windows Terminal (`wt`) unterstützt. Wenn nicht installiert → Fehler. Fix: Fallback auf `cmd.exe /k cd /d`. |
| 33 | 2026-02-17 | allgemein | **correlate_software: Falscher Feldname** - Backend erwartete `displayName`, aber `audit_software` liefert `name`. Fix: Fallback `.get("displayName").or_else(|| .get("name"))`. Lehre: Bei Funktionen die Daten von anderen Funktionen erhalten, IMMER die Feldnamen beider Seiten prüfen. |
| 34 | 2026-02-17 | netzwerk | **get_connection_diff: removed immer leer** - Entfernte Verbindungen wurden nie erkannt, `removed: []` war hardcoded. Fix: Prev-Connections mit Current vergleichen, fehlende als "closed" Events melden. |
| 35 | 2026-02-17 | allgemein | **get_system_profile: partitions=0** - Disk-Partitionsanzahl war hart auf 0 kodiert. Fix: `Get-Disk` pro PhysicalDisk abfragen für `NumberOfPartitions`. |
| 36 | 2026-02-17 | performance | **Blockierende I/O in async Funktionen** - `std::fs::write`, `std::fs::OpenOptions`, `std::fs::read_dir` in async `#[tauri::command]` blockieren den Tokio-Runtime-Thread. Fix: `tokio::fs` + `tokio::task::spawn_blocking`. Lehre: In async Commands IMMER `tokio::fs` statt `std::fs` verwenden. |
| 37 | 2026-02-17 | netzwerk | **get_network_summary: .Count auf null** - PowerShell `(pipeline).Count` gibt `$null` zurück wenn Pipeline leer ist. Fix: `@(pipeline).Count` erzwingt Array-Kontext, gibt immer 0 statt null. |
| 38 | 2026-02-17 | performance | **list_network_recordings: Gesamte Datei gelesen** - `read_to_string` lud komplette Aufzeichnungsdateien in RAM nur für Header/Footer. Fix: `BufReader` liest nur erste und letzte Zeile, Fallback mit Line-Count nur wenn kein Footer. |
| 39 | 2026-02-17 | netzwerk | **resolve_ips: Inkonsistentes Caching** - `resolve_ips` cached nur nicht-leere Companies, `resolve_ips_background` cached auch leere. Folge: IPs ohne Company werden bei jedem Aufruf neu aufgelöst. Fix: Beide cachen konsistent (inkl. leere Strings). |
| 40 | 2026-02-17 | netzwerk | **get_bandwidth + get_polling_data: Race Condition** - Beide Funktionen nutzen denselben `bw_prev_store` mit demselben Adapter-Namen als Key. Bei gleichzeitigem Aufruf überschreiben sie gegenseitig die Prev-Werte → falsche Raten. Fix: Prefix `bw_` bzw. `poll_` pro Quelle. |
| 41 | 2026-02-17 | security | **disable_scheduled_task: Wildcard `-TaskName '*'`** - Deaktiviert ALLE Tasks in einem Pfad statt nur einen einzelnen. Könnte kritische System-Tasks abschalten. Fix: `task_name` Parameter obligatorisch, Wildcard verboten. Frontend sendet jetzt `path` und `name` getrennt. |
| 42 | 2026-02-17 | allgemein | **uninstall_bloatware: False Success** - `Ok(success: true)` auch wenn `packageFullName` fehlte (nichts deinstalliert). Fix: Fehler zurückgeben wenn Pflichtfeld fehlt. Lehre: Destruktive Operationen MÜSSEN bei fehlendem Input Err() zurückgeben, nie stillschweigend "Erfolg" melden. |
| 43 | 2026-02-17 | security | **open_with_dialog: Double-Quote nicht escaped** - Dateinamen mit `"` in PowerShell-Argument könnten Shell-Injection ermöglichen. Fix: `"` → `` `" `` (PowerShell-Escape). Lehre: Einfache UND doppelte Anführungszeichen escapen. |
| 44 | 2026-02-17 | performance | **terminal_destroy: child.wait() blockiert Tokio** - `std::sync::Mutex::lock()` + `child.kill()` + `child.wait()` blockieren den async Runtime-Thread. Fix: Mutex sofort droppen, kill+wait in `spawn_blocking`. |
| 45 | 2026-02-17 | allgemein | **get_update_history: Kein try/catch** - COM-Objekt-Aufruf ohne Fehlerbehandlung. Fix: try/catch mit Fallback auf leeres Array (konsistent mit check_windows_updates). |
| 46 | 2026-02-17 | allgemein | **deep_search_start: use_regex ignoriert** - Parameter `_use_regex` mit Underscore-Prefix → nie verwendet. Fix: Implementiert als `-match` (Regex) vs. `-like` (Wildcard) Umschaltung in PowerShell-Script. |
| 47 | 2026-02-17 | terminal | **Git Bash: Hardcoded Pfad** - `C:\Program Files\Git\bin\bash.exe` fester Pfad. Fix: `find_git_bash()` sucht dynamisch via `where git` und leitet den bash.exe-Pfad ab. Fallback auf bekannte Installationspfade. |
| 48 | 2026-02-17 | allgemein | **terminal_create: Spawn-Fehler = Ok statt Err** - Bei fehlgeschlagenem Prozess-Start wurde `Ok({"id": null})` statt `Err()` zurückgegeben. Frontend musste `id == null` prüfen statt normaler Fehlerbehandlung. Fix: `Err()` zurückgeben. |
