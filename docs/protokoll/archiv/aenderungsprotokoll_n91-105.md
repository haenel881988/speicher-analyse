# Änderungsprotokoll — Archiv #91–#105

> Archiviert am 2026-02-20. Aktives Protokoll: [`../aenderungsprotokoll.md`](../aenderungsprotokoll.md)

---

| # | Datum | Version | Typ | Beschreibung |
|---|-------|---------|-----|-------------|
| 105 | 2026-02-19 | v7.2.1 | refactor | **commands.rs in 8 Module aufgeteilt + Tiefenanalyse-Optimierungen** — Monolithische `commands.rs` (4175 Zeilen) in 8 Module aufgeteilt: `mod.rs` (Shared Helpers + Re-Exports), `cmd_scan.rs` (612), `cmd_files.rs` (676), `cmd_network.rs` (947), `cmd_privacy.rs` (305), `cmd_system.rs` (886), `cmd_terminal.rs` (250), `cmd_misc.rs` (435). Zusätzlich: N-3 RAM-Verbrauchs-Logging bei Scans (>1M Dateien → Warnung), N-5 Security-Architektur als Kommentar dokumentiert (5 Sicherheitsschichten), N-6 `as_array().unwrap()` durch Pattern-Matching ersetzt (4 Stellen), O-4 differenzierte PowerShell-Timeouts (30s Standard, 120s für COM/Registry, 300s für winget). Tiefenanalyse: 25/25 Findings behoben. |
| 104 | 2026-02-19 | v7.2.1 | improve | **Security-Härtung + UX-Fixes + Verzeichnis-Cache** — M-2: `validate_path()` gehärtet (Symlink-Schutz via `canonicalize()`, erweiterte Blocklist: `\Windows\`, `\Recovery`, `\EFI`, Trailing-Backslash-Bug behoben). M-4: Logging bei Lese-Zugriff auf Systempfade (`tracing::warn`). H-8: System-Score zeigt Hinweis-Banner bei fehlenden Analysedaten statt stille Standardwerte. M-7: Ignorierter `_command` Parameter aus `terminal_open_external` entfernt (Backend + Bridge). H-7: Analyse zeigt kein Handlungsbedarf (nur NetworkView hat Polling, hat activate/deactivate). L-2: Verzeichnis-Cache im Explorer (5s TTL, max 10 Einträge, Refresh invalidiert). Tiefenanalyse: 17/25 Findings behoben. |
| 103 | 2026-02-19 | v7.2.1 | improve | **Performance + Dead-Code-Bereinigung** — L-4: Sicherheits-Check von 1 sequenziellen PowerShell-Aufruf (16-17s) auf 3 parallele Gruppen via `tokio::join!` aufgeteilt (Ziel <8s). L-3: DNS-Timeout von 10s/8s auf 3s verkürzt (unerreichbare IPs blockieren nicht mehr). H-2: 3 tote Event-Listener entfernt (tray-action, open-folder, deep-search-progress) — kein Backend-Emitter vorhanden, Listener-Count 21→18 korrigiert. Tokio `macros`-Feature hinzugefügt. |
| 102 | 2026-02-19 | v7.2.1 | fix | **Battery-Polling auf Desktop-PCs gestoppt + doppelte Laufwerk-Abfrage behoben** — L-1/M-5: Bei `hasBattery=false` wird Akku-Polling per `clearInterval` sofort gestoppt (vorher 54 unnötige PowerShell-Aufrufe in 12 Minuten). L-5: `loadDrives()` verwendet jetzt Explorer-Daten wieder statt doppelter `Win32_LogicalDisk`-Abfrage. K-1-Verifikation: Scanner/Firewall/Registry-Cleaner nie ins Tauri portiert. Tiefenanalyse: 11/25 Findings behoben. |
| 101 | 2026-02-19 | v7.2.1 | docs | **Issue-Dateien konsolidiert** — Simons Ideen-Salat nach oben verschoben mit Status-Kommentaren (4/6 Explorer-Ideen umgesetzt). 4 veraltete Issue-Dateien archiviert. Issue #11/#20 als ENTFALLEN markiert. visionen.md + Tiefenanalyse aktualisiert. |
| 100 | 2026-02-19 | v7.2.1 | improve | **Eigenschaften-Dialog: Performance-Optimierung** — Tab "Allgemein" von PowerShell auf Rust-native umgestellt: Dateigröße, Zeitstempel, Attribute via `std::fs::metadata()` + `MetadataExt` (instant, <1ms statt ~500ms). Dateityp-Beschreibung + "Öffnen mit" via `cmd.exe` assoc/ftype (~50ms statt ~300ms PowerShell-Start). Sicherheits-Validierung für cmd-Parameter (Injection-Schutz). Tabs "Sicherheit" und "Details" werden jetzt parallel via `Promise.all` geladen (spart ~300ms bei beiden Tabs). Gesamtersparnis: Tab "Allgemein" ~10x schneller, Tab 2+3 ~40% schneller. |
| 99 | 2026-02-19 | v7.2.1 | feature | **Eigenschaften-Dialog mit 4 Tabs wie Windows Explorer** — Kompletter Umbau des Datei-Eigenschaften-Dialogs von flacher Key-Value-Liste zu 4-Tab-Layout: (1) Allgemein: Großes Dateityp-Icon, Dateiname, Dateityp-Beschreibung (via assoc/ftype), Öffnen-mit-Programm, Speicherort, Größe + Größe auf Datenträger (Cluster-aligned via Get-Volume), Enthält (Ordner: async), Erstellt/Geändert/Zugriff, Attribute-Checkboxen (Schreibgeschützt/Versteckt/Archiv). (2) Sicherheit: Besitzer (Owner), ACL-Tabelle mit Benutzer/Gruppe, Zulassen/Verweigern, Berechtigungen (Vollzugriff/Ändern/Lesen/Schreiben), geerbt-Markierung. (3) Details: Erweiterte Metadaten via Shell.Application COM-Objekt (Abmessungen, Kameramodell, Interpret, Album, Dauer, Bitrate, Aufnahmedatum etc.), EXE/DLL VersionInfo (Produktname, Version, Firma, Copyright), MD5/SHA-256 Prüfsummen-Buttons (on-demand). (4) Vorgängerversionen: Volume Shadow Copy Snapshots mit Datum, Typ und Größe. 5 neue Backend-Commands (file_properties_general, file_properties_security, file_properties_details, file_properties_versions, file_properties_hash), 5 Bridge-Mappings, PropertiesDialog-Klasse mit Lazy-Loading pro Tab und Cache. getFileIcon/FILE_TYPE_ICONS/EXT_TO_ICON aus explorer.js exportiert für Wiederverwendung. |
| 98 | 2026-02-19 | v7.2.1 | refactor | **Verwaiste Scanner-CSS bereinigt** — 105 Zeilen toter CSS-Code aus style.css entfernt: netinv-* (Geräte-Inventar-Tabelle, 16 Gerätetyp-Farben, Gruppierung, Badges), network-device-* (Geräte-Zeilen, Detail-Ansicht, Status-Anzeige), network-scan-* (Scan-Fortschritt, Spinner, Progress-Bar), network-rtt-* (Latenz-Farbkodierung), network-port-badge, network-local-badge, network-privacy-badge und 2 zugehörige @keyframes-Animationen. Behalten: network-devices-toolbar (von History-View genutzt) und network-state-pills (von Verbindungs-Detail genutzt). |
| 97 | 2026-02-19 | v7.2.1 | refactor | **IP-Scanner aus Netzwerk-Monitor entfernt** — Gesamten "Lokale Geräte"-Tab mit ~470 Zeilen totem Frontend-Code entfernt (Netzwerk-Scan, Port-Scan, SMB-Freigaben, Geräte-Inventar, CSV-Export, Blockieren-Button, 17 SVG-Geräte-Icons). Backend/Bridge hatten keine Scanner-Commands (nie implementiert nach Tauri-Migration). oui.rs bleibt erhalten (hostname_to_company + is_tracker werden vom Verbindungs-Monitor benötigt). 5 Log-Analyse-Findings (Akku-Polling, doppelte Verzeichnis-Abfragen, IP-Auflösung 12s, Sicherheits-Check 17s, doppelte Laufwerk-Abfrage) in issue.md dokumentiert. Strategische Entscheidung in issue.md als "Umgesetzt" markiert. |
| 96 | 2026-02-19 | v7.2.1 | refactor | **Letzte Electron-Fragmente bereinigt** — Systematische Suche nach Electron-Resten im gesamten Projekt: (1) terminal-panel.js Kommentar korrigiert ("node-pty" durch "piped I/O" ersetzt). (2) issue.md: Veralteten Eintrag "restore-window.ps1 sucht nach Electron" entfernt (bereits in v7.2.1 #95 gefixt). (3) projektplan.md: "Electron powerMonitor" durch "Web Battery API + Tauri System-Info" ersetzt. (4) visionen.md: "Electron" durch "Tauri v2" ersetzt. (5) Changelog: 5 Electron-Ära Lessons (#4-#8) entfernt — bereits in docs/lessons-learned archiviert, für Tauri irrelevant. Drittanbieter-Libs (Monaco, mammoth, html2pdf), historische Docs und Lessons-Learned korrekt als "kein Handlungsbedarf" verifiziert. |
| 95 | 2026-02-19 | v7.2.1 | improve | **Tiefenanalyse-Fixes: 14 Findings behoben (3 Kritisch, 4 Hoch, 3 Mittel, 1 Niedrig, 3 kein Fix nötig)** — Ergebnis der systematischen Tiefenanalyse v2.2. (1) KRITISCH K-1: Scanner/Firewall/Registry-Code komplett entfernt (~849 Zeilen commands.rs, registry.js gelöscht, oui.rs auf hostname_to_company+is_tracker reduziert, Bridge/lib.rs/app.js/dashboard.js/index.html bereinigt) — AV-Risiko eliminiert. (2) KRITISCH K-2: `unsafe-eval` aus CSP entfernt. (3) KRITISCH K-3: `validate_path()` Prüfung vor `delete_to_trash` hinzugefügt. (4) HOCH H-1: restore-window.ps1 Electron-Referenz auf Speicher-Analyse korrigiert. (5) HOCH H-2: Toten Event-Listener `onFileOpProgress` entfernt (3 weitere als gültig verifiziert). (6) HOCH H-3: Mutex `.lock().unwrap()` durch `.unwrap_or_else(|e| e.into_inner())` ersetzt — verhindert Cascade-Panics bei Mutex-Poisoning (commands.rs + scan.rs). (7) HOCH H-4: 3 englische PowerShell-Fehlermeldungen auf Deutsch übersetzt (ps.rs). (8) HOCH H-6: `destroy()` Methode zu 15 Views hinzugefügt (autostart, bloatware, cleanup, dashboard, duplicates, old-files, optimizer, preview, search, security-audit, services, settings, system-profil, tree, updates). (9) MITTEL M-1: `#[allow(dead_code)]` von ScanData entfernt. (10) MITTEL M-6: `open_external` blockiert URLs mit `@` (eingebettete Anmeldedaten). (11) NIEDRIG N-4: `delete_network_recording` von `std::fs` auf `tokio::fs` migriert (async). 3 Findings als bereits korrekt implementiert bestätigt (H-7 activate/deactivate, H-8 stub-check system_score, M-4 read-Pfade). |
| 94 | 2026-02-18 | v7.2.1 | refactor | **CLAUDE.md Lesson-Learned-Migration + Gründlichkeits-Policy** — Sämtliche Lesson-Learned-Inhalte (historische Anekdoten, Migrations-Erzählungen, Bug-Referenzen) aus CLAUDE.md in `docs/lessons-learned/lessons-learned.md` migriert (#86, #87). CLAUDE.md enthält jetzt nur noch Prinzipien und Regeln, keine Geschichten. Neue Policy "Prinzip 3c: Gründlichkeit vor Effizienz" hinzugefügt — verbietet oberflächliche Quick-Scans und erzwingt vollständiges Lesen, alle Treffer prüfen, Analysen abschliessen. Veraltete API-Zahlen korrigiert (147→150 Methoden, 21 Event-Listener). MEMORY.md synchronisiert. |
| 93 | 2026-02-18 | v7.2.1 | security | **XSS-Fix: escapeHtml() escaped keine Anführungszeichen** — `escapeHtml()` in utils.js nutzte den `textContent→innerHTML`-DOM-Trick, der laut HTML-Spec nur `<>&` escaped, NICHT `"'`. In 15+ Dateien wurde `escapeHtml()` in Attribut-Kontexten verwendet (`title="..."`, `data-path="..."`, `value="..."`) → Dateinamen mit `"` hätten aus Attributen ausbrechen können. Fix: Regex-basierte Implementierung die `&<>"'` escaped. `escapeAttr()` = Alias für `escapeHtml()`. 4 lokale Varianten entfernt (autostart.js eigene `esc()`, explorer.js `escAttr()`, explorer-tabs.js `_escAttr()`, treemap.js `escapeHtml()`). Bridge-Zähler korrigiert (150/21 statt 149/22). Lesson-Learned #85 dokumentiert. |
| 92 | 2026-02-18 | v7.2.1 | fix | **Tiefenanalyse: 13 Bugs gefixt (6 Crash, 3 Funktionsfehler, 4 Qualität)** - (1) KRITISCH: `deleteToTrash`/`deletePermanent`/`clipboardPaste` riefen `.filter()` auf einzelnem Objekt statt Array → TypeError bei jeder Datei-Operation. Fix: Frontend prüft jetzt `result.success` direkt. (2) KRITISCH: `file_properties` gibt `isDir`/`readOnly` zurück, Frontend las `isDirectory`/`readonly` → Ordner immer als "Datei" angezeigt, Schreibschutz immer "Nein". Fix: Beide Varianten per `||` akzeptiert. (3) KRITISCH: `calculateFolderSize` Feldnamen `result.size`/`files`/`dirs` statt Backend-Return `totalSize`/`fileCount`/`dirCount`. Fix: Korrekte Feldnamen. (4) KRITISCH: `delete_to_trash` nutzte `DeleteFile()` — scheiterte bei Ordnern. Fix: `Test-Path -PathType Container` → `DeleteDirectory()` für Ordner. (5) KRITISCH: `file_copy` via `tokio::fs::copy()` konnte keine Ordner kopieren. Fix: Rekursive Kopie mit `walkdir`. (6) HOCH: `show_save_dialog` ignorierte `options`-Parameter (Underscore-Prefix `_options`) → "Entpacken nach..." zeigte Datei-Speichern statt Ordner-Auswahl. Fix: `options.directory` → `pick_folder()`. (7) HOCH: `extract-to` prüfte `if (dest)` (Objekt, immer truthy) und übergab Objekt statt `dest.path`. Fix: `!dest.canceled && dest.path`. (8) MITTEL: Context-Menü registrierte bei jedem Rechtsklick 2 Event-Listener die bei externem Close nie entfernt wurden → Memory-Leak. Fix: Handler in Modul-Variablen, Cleanup in `closeContextMenu()`. (9) NIEDRIG: `calculateFolderSize` Kontextmenü-Handler ohne `.catch()`. (10) NIEDRIG: `tree.js` und `search.js` hatten lokale `escapeHtml()`/`escapeAttr()` Kopien statt Import aus utils.js. Fix: Imports, lokale Methoden entfernt. 6 Lessons-Learned dokumentiert (#65-#70). |
| 91 | 2026-02-18 | v7.2.1 | feature+fix | **7 Fixes + Strategische Planung** - (1) README.md aktualisiert (Electron→Tauri v2, npm→cargo). (2) Netzwerk-Geräte-Klassifizierung: SSDP-Daten werden jetzt VOR Port/Vendor-Heuristik ausgewertet, Vendor-only Drucker-Zuordnung entfernt (Canon-Kamera≠Drucker). (3) Kontextmenü: Neues Frontend-Popup (`context-menu.js`) ersetzt den kaputten Rust-Event-Roundtrip. Positioniertes Menü mit Rand-Erkennung, ESC/Klick-außerhalb schließt. (4) Zip-Extraktion: Neuer `extract_archive` Command (PowerShell Expand-Archive), Kontextmenü-Einträge "Hier entpacken" / "Entpacken nach...". (5) Global Hotkey: `tauri-plugin-global-shortcut` v2 integriert, `set_global_hotkey` nutzt echtes Plugin-API (kein Stub mehr), gespeicherter Hotkey wird beim App-Start automatisch registriert, Fenster wird bei Tastendruck fokussiert. (6) Eigenschaften-Dialog: Ordnergröße wird jetzt asynchron via `calculateFolderSize` berechnet und mit Datei-/Ordner-Anzahl angezeigt. (7) EXE als Administrator: Neuer `run_as_admin` Command (Start-Process -Verb RunAs), Kontextmenü-Eintrag bei .exe/.msi-Dateien. **Strategische Entscheidung:** IP-Scanner und Registry-Cleaner werden aus der App entfernt (AV-Risiko in Firmenumgebungen). Produktstrategie Stufe 2 angepasst. |
