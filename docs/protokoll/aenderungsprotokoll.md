# Änderungsprotokoll

> **Regel:** Maximal 30 Einträge. Bei Überschreitung die ältesten in `archiv/` verschieben (Dateiname: `aenderungsprotokoll_<version>.md`).

Archiv: [`archiv/aenderungsprotokoll_v7.0-v7.2.md`](archiv/aenderungsprotokoll_v7.0-v7.2.md) (30 Einträge, v7.0–v7.2)
Archiv: [`archiv/aenderungsprotokoll_v7.3-v7.5.md`](archiv/aenderungsprotokoll_v7.3-v7.5.md) (15 Einträge, v7.3–v7.5)
Archiv: [`archiv/aenderungsprotokoll_v7.3-v8.0.md`](archiv/aenderungsprotokoll_v7.3-v8.0.md) (15 Einträge, v7.3–v8.0)
Archiv: [`archiv/aenderungsprotokoll_v7.2.1-v7.3.md`](archiv/aenderungsprotokoll_v7.2.1-v7.3.md) (15 Einträge, v7.2.1–v7.3)
Archiv: [`archiv/aenderungsprotokoll_v7.2.1-n31-45.md`](archiv/aenderungsprotokoll_v7.2.1-n31-45.md) (15 Einträge, #31–#45)
Archiv: [`archiv/aenderungsprotokoll_n46-60.md`](archiv/aenderungsprotokoll_n46-60.md) (15 Einträge, #46–#60)

---

| # | Datum | Version | Typ | Beschreibung |
|---|-------|---------|-----|-------------|
| 88 | 2026-02-17 | v7.2.1 | fix | **Bridge-Audit: menu-action Listener + Methodenzähler** - (1) Fehlender `onMenuAction` Listener in tauri-bridge.js: Backend emittierte `"menu-action"` für den "Über Speicher Analyse"-Menüeintrag, aber die Bridge hatte keinen Listener dafür. Klick ging ins Leere. Fix: Listener in Bridge + Handler in app.js ergänzt. (2) Methodenzähler in console.log war veraltet (148/20 statt 149/22). 1 Lesson-Learned dokumentiert (#61). |
| 87 | 2026-02-17 | v7.2.1 | fix | **Frontend-Audit: 39 Bugs analysiert, 15+ Fixes implementiert** - (1) HOCH: `tabLoaded` in app.js wurde VOR erfolgreichem `await`-Call gesetzt — bei API-Fehler konnte der Tab nie neu geladen werden. Fix: Alle 11 Fälle umgestellt (Flag erst NACH `await`), try-catch ergänzt. (2) HOCH: preview.js hatte lokale `escapeHtml()` die `'` nicht escaped — XSS-Risiko. Fix: Importierte `escapeHtml()` aus utils.js verwendet. (3) HOCH: `sanitizeHtml()` prüfte `javascript:` case-sensitive — Mixed-Case umging den Check. Fix: Redundanten ersten Check entfernt, case-insensitiver Check (Zeile 598) greift. (4) MITTEL: 10 Dateien hatten lokale `_esc()` Duplikate statt zentraler `escapeHtml()` aus utils.js (Regelverletzung). Fix: Alle 10 Dateien bereinigt — Import ergänzt, `this._esc()` durch `escapeHtml()` ersetzt, lokale Definition entfernt. (5) MITTEL: `confirm()` in network.js (2x) durch `window.api.showConfirmDialog()` ersetzt (konsistente UX). (6) NIEDRIG: 5 Umlaut-Fehler behoben ("Grösse"→"Größe", "Verschleiss"→"Verschleiß", "anschliessen"→"anschließen", "schliessen"→"schließen"). 4 Lessons-Learned dokumentiert (#57-#60). |
| 86 | 2026-02-17 | v7.2.1 | fix | **Tiefenaudit Runde 5: 2 Bugs in Privacy + Netzwerk-Export** - (1) diagnose-toast: `recommendedValue` in `build_privacy_settings` war `0`, aber `privacy_setting_lookup` verwendete `recommended: 1`. Nach Anwenden zeigte die UI dauerhaft "nicht privat", weil Anzeige gegen falschen Wert prüfte. Fix: `recommendedValue` auf `1` korrigiert. (2) export_network_history CSV: Felder `connections`, `bandwidthRx`, `bandwidthTx` existierten nicht in der Snapshot-Struktur — CSV-Export produzierte nur Nullen. Fix: CSV liest jetzt korrekte Felder aus `data.summary` (totalConnections, establishedCount, listeningCount, udpCount) und Prozessanzahl aus `grouped`. 2 Lessons-Learned dokumentiert (#55-#56). |
| 85 | 2026-02-17 | v7.2.1 | fix | **Tiefenaudit Runde 4: 7 Bugs in ps.rs, oui.rs, scan.rs** - (1) ps.rs: UTF-8 Panic in `script_preview()` und `run_ps_json()` — Byte-Slicing `&str[..120]` kann bei Multi-Byte-Zeichen (Umlaute) in der Mitte schneiden → Panic. Fix: `is_char_boundary()` für sichere Truncation. (2) oui.rs: 3 fehlerhafte OUI-Prefixes — Juniper 7-stellig, Synology 7-stellig, QNAP mit Doppelpunkten — matchen nie weil lookup() nur 6-stellige Hex-Strings vergleicht. Fix: Korrigiert/entfernt. (3) oui.rs: `h.contains("tv")` klassifiziert Hostnamen wie "entwickler-pc" fälschlich als Smart-TV. Fix: Spezifischere Patterns (`-tv`, `tv-`, `smart-tv`). (4) scan.rs: `normalize_dir_key` ohne Case-Normalisierung — Windows ist case-insensitive, Index-Lookup scheitert bei unterschiedlicher Groß/Kleinschreibung. Fix: `.to_lowercase()`. (5) scan.rs: CSV-Export hatte überflüssiges Trailing-Semikolon. (6) scan.rs: `file_count` war inkonsistent (Root=own, Kinder=total). Fix: Einheitlich `total_file_count`. (7) oui.rs: `is_tracker()` Pattern `.analytics.` und `.facebook.com/tr` zu breit — spezifischere Patterns. 6 Lessons-Learned dokumentiert (#49-#54). |
| 84 | 2026-02-17 | v7.2.1 | fix | **Tiefenaudit Runde 3: 8 Security/Funktions-Bugs gefixt** - (1) disable_scheduled_task: Wildcard `-TaskName '*'` deaktivierte ALLE Tasks in einem Pfad — könnte kritische System-Tasks abschalten. Fix: `task_name` Pflichtparameter, Frontend sendet `path` und `name` getrennt. (2) uninstall_bloatware: Meldete `success: true` auch wenn `packageFullName` fehlte und nichts passierte. Fix: Err() bei fehlendem Pflichtfeld. (3) open_with_dialog: Dateinamen mit `"` nicht escaped → Command Injection möglich. Fix: `"` → `` `" ``. (4) terminal_destroy: `child.kill()` + `child.wait()` blockierten Tokio-Runtime unter Mutex. Fix: Session aus Mutex entfernen, dann kill+wait in `spawn_blocking`. (5) get_update_history: COM-Objekt-Aufruf ohne try/catch — bei fehlendem Windows-Update-Service crash. Fix: try/catch mit leerem Array-Fallback. (6) deep_search_start: `use_regex` Parameter war ignoriert. Fix: `-match` (Regex) vs. `-like` (Wildcard) Umschaltung. (7) Git Bash: Hardcoded Pfad `C:\Program Files\Git\...`. Fix: `find_git_bash()` sucht dynamisch via `where git`. (8) terminal_create: Spawn-Fehler gab `Ok({id: null})` zurück statt `Err()`. 8 Lessons-Learned dokumentiert (#41-#48). |
| 83 | 2026-02-17 | v7.2.1 | fix | **Tiefenaudit Runde 2: 8 weitere Bugs gefixt** - (1) correlate_software: Falscher Feldname `displayName` statt `name` — Software-Korrelation schlug fehl weil audit_software das Feld `name` liefert. Fix: Fallback auf beide Feldnamen. (2) get_connection_diff: `removed`-Array war hardcoded leer — geschlossene Verbindungen wurden nie erkannt. Fix: Prev vs Current Vergleich mit HashSet (O(1) statt O(n*m)). (3) get_system_profile: `partitions=0` hardcoded — echte Partitionsanzahl per `Get-Disk`. (4) Blocking I/O in 4 Network-Recording-Funktionen: `std::fs` blockierte Tokio-Runtime → `tokio::fs` + `spawn_blocking`. Mutex-Logik entkoppelt (Lock nur für State, I/O außerhalb). (5) get_network_summary: `.Count` auf leerer Pipeline → `@(pipeline).Count` für null-Schutz. (6) list_network_recordings: Gesamte Datei in RAM geladen nur für Header/Footer → BufReader liest nur erste/letzte Zeile. (7) resolve_ips: Inkonsistentes Caching (leere Companies nur in Background gecached) → beide Pfade cachen jetzt konsistent. (8) get_bandwidth/get_polling_data Race Condition: Gleichzeitige Aufrufe überschrieben gegenseitig Prev-Werte → separate Store-Keys mit Prefix `bw_`/`poll_`. 8 Lessons-Learned dokumentiert (#33-#40). |
| 82 | 2026-02-17 | v7.2.1 | fix | **Tiefenaudit: 18+ Bugs gefixt (Netzwerk, Terminal, Security, Privacy, Frontend)** - Ergebnis einer vollständigen Code-Analyse (88 Bugs identifiziert, kritischste behoben): (1) Netzwerk: classify_device() gibt jetzt dynamische Labels mit Herstellernamen zurück ("Brother Drucker" statt "Drucker"), friendlyName/modelName bevorzugt. ARP-Race-Condition in beiden Scan-Funktionen behoben (zweite ARP-Lesung nach Ping-Sweep). Firmen endlich sichtbar durch zweiten Refresh nach 12s. OUI-Datenbank wird beim ersten Active-Scan automatisch heruntergeladen. SMB-Shares Fallback auf net view. detect_os Byte-Index-Bug gefixt. (2) Terminal: UTF-8-Encoding wird nach Shell-Spawn automatisch gesetzt (PowerShell: OutputEncoding+InputEncoding, CMD: chcp 65001). terminal_open_external mit Fallback auf cmd.exe. (3) Security: withGlobalTauri auf false gesetzt, Context-Menu Event-Name synchronisiert, resolve_ips mit IP-Validierung. (4) Privacy: REG_SZ statt REG_DWORD für CapabilityAccessManager-Settings. Autostart RunOnce-Substring-Match behoben. Umlaute in PowerShell-Strings korrigiert. (5) Frontend: destroy() in 5 Views ergänzt (Memory-Leak-Prävention), preview.js escapeHtml um Quote-Escaping erweitert, MAC-Fallback in passivem Scan. 32 Lessons-Learned dokumentiert. |
| 81 | 2026-02-17 | v7.2.1 | improve | **Netzwerkscan: Dynamische OUI-Datenbank, SSH/HTTP-Banner, OS-Erkennung** - Umfassende Erweiterung des aktiven Netzwerk-Scans: (1) Dynamische OUI-Datenbank: Die heruntergeladene IEEE oui.txt (~30.000+ Einträge) wird jetzt beim App-Start und nach jedem Download automatisch in den Speicher geladen — vorher lag die Datei ungenutzt auf der Festplatte, nur die statische Tabelle mit ~200 Einträgen wurde verwendet. (2) Erweiterte SSDP/UPnP-Erkennung: Doppelter M-SEARCH (Retry für UDP-Zuverlässigkeit), 5s statt 4s Empfangsfenster, neue XML-Felder extrahiert (modelNumber, serialNumber, modelDescription), SSDP SERVER-Header wird für OS-Erkennung gespeichert. (3) SSH-Banner-Grabbing: Parallele TCP-Verbindung zu Port 22 liest den SSH-Versions-Banner (z.B. "SSH-2.0-OpenSSH_8.9p1 Ubuntu-3") — identifiziert OS und SSH-Version. (4) HTTP-Server-Header: HEAD-Request an Port 80 liest den Server-Header (z.B. "nginx", "Apache", "MikroTik") für Geräte-Identifikation. (5) TTL-basierte OS-Erkennung: Ping-TTL wird erfasst und ausgewertet (64=Linux/macOS, 128=Windows, 255=Netzwerkgerät), kombiniert mit SSDP-SERVER und SSH-Banner für bestmögliche OS-Bestimmung. (6) Alle 6 fehlenden Frontend-Felder werden jetzt befüllt: os, firmwareVersion, serialNumber, sshBanner, httpServer, identifiedBy (erweitert um SSH/HTTP). Neue CSS-Badges für OS und HTTP-Server im Frontend. |
| 80 | 2026-02-17 | v7.2.1 | fix | **4 Migrations-Fixes: Performance, PDF-Anzeige, Terminal, Explorer-Icons** - (1) Performance-Optimierung: Verzeichnis-Index (DirIndexEntry HashMap) ermöglicht O(1)-Zugriff auf Ordnergrößen statt O(N)-Scan aller Dateien bei jedem Verzeichniswechsel. Bincode-Serialisierung (5-10x schneller als JSON) für Scan-Daten-Persistenz mit automatischer JSON→bincode Migration. Verzeichniswechsel von 2-3 Sekunden auf unter 50ms. (2) PDF/DOCX/XLSX-Anzeige repariert: Base64-Dekodierung fehlte — Tauri serialisiert Binärdaten als Base64-Strings (Electron konnte ArrayBuffers direkt übergeben). atob() + charCode-Schleife in preview.js für alle 3 Formate. (3) Terminal repariert: stdout/stderr wurden nie gelesen (piped I/O ohne Reader-Threads), Shell-Feldnamen passten nicht (Backend: "name", Frontend: "label"+"available"). Background-Threads für stdout/stderr mit app.emit("terminal-data"/"terminal-exit"). (4) Explorer: SVG-Dateityp-Icons mit 15 Typen (PDF rot, Ordner gelb, Code grün, Bilder lila, etc.) und ~80 Dateiendungs-Zuordnungen ersetzen die generischen Emoji-Icons. Farbkodierung per CSS-Klassen. |
| 79 | 2026-02-17 | v7.2.1 | fix | **Scan-Persistenz, SSDP-Modell-Erkennung, 3 weitere Fixes** - (1) Speicher-Scan-Daten werden jetzt auf Disk persistiert (`scan-meta.json` + `scan-data.json` in %APPDATA%/speicher-analyse/) — beim Neustart lädt `getRestoredSession` die Daten automatisch in den Memory-Store zurück, sodass Tree, Charts und alle Abfragen sofort funktionieren ohne erneuten Scan. (2) Netzwerk-Scan um SSDP/UPnP-Modell-Erkennung erweitert (Phase 3): M-SEARCH Multicast an 239.255.255.250:1900, XML-Device-Descriptions werden heruntergeladen und modelName/manufacturer/friendlyName extrahiert — Geräte wie "Fritz!Box 7590" werden jetzt mit echtem Modellnamen angezeigt statt nur "Router/Gateway". (3) Netzwerk-Scan-Daten ebenfalls auf Disk persistiert (`last-network-scan.json`), werden beim Neustart aus der Datei geladen. (4) `deep_search_cancel` komplett neu: Speichert PID des PowerShell-Prozesses und beendet ihn per `taskkill /PID /T /F` — vorher lief der Prozess nach "Abbrechen" im Hintergrund weiter. (5) `terminal_resize` korrekterweise als Stub markiert (`stub: true` statt irreführendem `success: true`). (6) Verzeichnis-Anzeige nach Scan flüssiger: `loadAllViews` lädt Tree sofort (nicht-blockierend), Charts und Top-Dateien parallel via `Promise.allSettled`. |
| 78 | 2026-02-17 | v7.2.1 | fix | **Tiefenanalyse: 2 Netzwerk-Bugs behoben** - (1) Firmen-Zuordnung in der Detail-Ansicht fehlte: `get_polling_data` setzte `resolved.org` für jede einzelne Verbindung auf leer, obwohl die Firma im IP-Resolve-Cache vorhanden war. Die Firma wurde nur auf Gruppen-Ebene (`resolvedCompanies`) gemappt, nicht auf die einzelnen Verbindungen zurückgeschrieben. Fix: `IP_RESOLVE_CACHE` wird jetzt bereits beim Bauen der Verbindungsliste ausgelesen und pro Verbindung in `resolved.org` geschrieben — die Firma erscheint jetzt in der Verbindungs-Tabelle. (2) Port-Scan (`scan_device_ports`) meldete fälschlich Ports als "offen": Die PowerShell-Prüfung verwendete nur `$t.task.IsCompleted -and -not $t.task.IsFaulted`, prüfte aber nicht `$t.client.Connected`. Dadurch wurden Ports als offen gemeldet auch wenn die Verbindung abgelehnt wurde. Fix: `$t.client.Connected` zur Prüfung hinzugefügt (konsistent mit `scan_network_active`). Tiefenanalyse aller Scan-Funktionen: Disk-Scan, Duplikat-Scan, Security-Audit (12 Prüfungen), Registry-Scan, Cleanup, Session-Restore, Netzwerk-Aufzeichnung/Snapshots — alle verifiziert und funktionsfähig. OUI-Modul (220 Hersteller), Geräteklassifizierung (Ports + Hostname + Vendor), IP→Firma-Auflösung (50+ Firmen), Tracker-Erkennung — vollständig integriert. Keine verbleibenden Stubs gefunden. |
| 77 | 2026-02-16 | v7.2.1 | fix | **31 Stubs durch echte Implementierungen ersetzt** - Alle nach der Tauri v2 Migration fehlenden Funktionen implementiert: (1) Session-Restore liest jetzt gespeicherte Session-Daten zurück (war immer null). (2) Sicherheitscheck von 3 auf 12 Prüfungen erweitert (Defender-Echtzeitschutz, Virendefinitionen-Alter, Windows-Updates, BitLocker, SMBv1, Remotedesktop, Passwort-Richtlinie, Secure Boot, Autostart-Anzahl). (3) Audit-History wird in audit-history.json persistiert (max. 20 Einträge). (4) Netzwerk-Aufzeichnung komplett implementiert — Start/Stop mit JSONL-Dateien, Events anhängen, Aufzeichnungen auflisten/löschen/Verzeichnis öffnen. (5) Netzwerk-Snapshots speichern/laden/löschen/exportieren (JSON + CSV). (6) Duplikat-Finder mit echtem Size-Based + Partial-Hash-Scan, Fortschritts-Events und Abbruch-Funktion. (7) Admin-Elevation über PowerShell Start-Process -Verb RunAs. (8) Terminal: Dynamische Shell-Erkennung (PowerShell 7, Windows PowerShell, CMD, Git Bash, WSL), Session-Verwaltung mit Piped I/O. (9) Software-Korrelation findet zugehörige Dateien, Registry-Keys und Services. (10) Software-Updates via winget upgrade. (11) Registry-Backup-Wiederherstellung listet vorhandene Backups. (12) Screenshot via System.Drawing. (13) Datenschutz-Empfehlungen erkennen telemetrielastige Programme. (14) OUI-Datenbank-Download via IEEE. |
| 76 | 2026-02-16 | v7.2.1 | feature | **Netzwerk-Informationen wiederhergestellt** - Fehlende Netzwerk-Daten nach der Tauri v2 Migration komplett wiederhergestellt: (1) Neues OUI-Modul (`oui.rs`) mit ~220 MAC-Herstellerpräfixen für Offline-Herstellererkennung (Apple, Samsung, TP-Link, Netgear, etc.). (2) Aktiver Netzwerk-Scan (`scan_network_active`) um paralleles Port-Scanning (11 Ports) und Rust-seitige Geräteklassifizierung erweitert — jedes Gerät erhält Hersteller, Gerätetyp, Label und Icon basierend auf offenen Ports, Hostname und MAC-Adresse. (3) IP-Auflösung (`resolve_ips`) vollständig implementiert — parallele Reverse-DNS-Auflösung mit Zuordnung zu ~50 Firmen (Google, Microsoft, Apple, Meta, AWS, Deutsche Telekom, Vodafone, etc.) und Tracker-Erkennung. (4) Polling-Daten (`get_polling_data`) mit Firmen-Zuordnung über einen Hintergrund-Cache — aufgelöste IPs werden gecacht und bei jedem Poll-Zyklus in die Prozessgruppen eingebettet. (5) Passiver Scan (`scan_local_network`) um OUI-Herstellerzuordnung und korrekte Feldnamen erweitert. (6) Explorer: Silent-Catch bei Ordnergrößen durch geloggte Warnung ersetzt. |
| 75 | 2026-02-16 | v7.2.1 | feature | **Dev-Logging mit tracing** - Umfassendes Logging-System für die Entwicklerversion implementiert: Rust-Backend nutzt das `tracing`-Crate mit `tracing-subscriber` (nur aktiv im Debug-Build via `cfg!(debug_assertions)`). PowerShell-Aufrufe werden mit Script-Preview, Ausführungsdauer und Fehlerdetails geloggt (ps.rs). Kritische Commands (Scan, Löschung, Service-Steuerung, Firewall, Privacy, Registry, Bloatware, Optimierung, Netzwerk-Scan) loggen ihre Ausführung mit Parametern. Neuer `log_frontend`-Command ermöglicht dem Frontend, Fehler ins Backend-Log zu senden. Globale Error-Handler (`window.onerror`, `unhandledrejection`) in app.js fangen unbehandelte Frontend-Fehler ab und leiten sie an das Backend weiter. Log-Level steuerbar via `RUST_LOG` Umgebungsvariable (Standard: `speicher_analyse_lib=debug,warn`). Logs werden in `docs/logs/` geschrieben (Konsole + Datei gleichzeitig). |
| 74 | 2026-02-16 | v7.2.1 | fix | **Netzwerk-Scan repariert** - Zwei Wurzelursachen behoben: (1) Datenformat-Mismatch — das Backend gab ein flaches Array zurück, aber das Frontend erwartete ein Objekt mit `{devices, subnet, localIP}`. Der Zugriff auf `.devices.length` schlug fehl und der Scan zeigte "fehlgeschlagen" obwohl die Daten korrekt ermittelt wurden. (2) Sequenzielle DNS-Auflösung — `GetHostEntry()` blockierte pro Host 5+ Sekunden, was bei mehreren Geräten den 30-Sekunden-Timeout überschritt. Ersetzt durch parallele `GetHostEntryAsync()` mit `WaitAll(5000/8000)`. Zusätzlich: Scan-Ergebnis wird jetzt im Backend gecacht (`LAST_NETWORK_SCAN`), damit `get_last_network_scan()` das letzte Ergebnis nach Page-Reloads zurückgeben kann. Router/Gateway und eigener PC werden automatisch erkannt. Per CDP-Test verifiziert: 10 Geräte im Netzwerk gefunden, gruppiert nach Typ, Toast "10 Geräte gefunden" sichtbar. |
| 73 | 2026-02-16 | v7.2.1 | refactor | **Electron-Bereinigung** - Komplette Entfernung aller Electron-Fragmente nach der Tauri v2 Migration: `main/` Verzeichnis mit 52 Electron-Dateien geloescht (main.js, preload.js, ipc-handlers.js etc.), `launch.js` und `scripts/rebuild-pty.js` geloescht, `package-lock.json` neu generiert (561 auf 94 Pakete, 0 Electron-Dependencies), veraltete Electron-Kommentare in 7 Dateien aktualisiert (tauri-bridge.js, preview.js, index.html, commands.rs, wcag-gate.js, .gitignore), Skills `/test-issue` und `/visual-verify` um WebView2-CDP-Anleitung ergaenzt (WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS Umgebungsvariable). |
| 72 | 2026-02-16 | v7.2.1 | fix | **Fehlende Tauri v2 Capabilities hinzugefügt** - Scan-Events (Progress/Complete/Error) erreichten das Frontend nicht, weil die Datei `src-tauri/capabilities/default.json` fehlte. Ohne `core:event:default` blockierte Tauri v2 alle `event.listen()`-Aufrufe mit dem Fehler "event.listen not allowed". Dadurch startete der Scan zwar im Backend (walkdir lief korrekt, `app.emit()` gab `Ok(())` zurück), aber das Frontend empfing keine Events — die Fortschrittsanzeige blieb leer und der Scan schien nie fertig zu werden. Fix: `capabilities/default.json` mit `core:default`, `shell:allow-open`, `dialog:default`, `clipboard-manager:allow-write-text` erstellt. Zusätzlich: CSP-Duplikat behoben — HTML hatte eine eigene CSP Meta-Tag die mit der CSP aus `tauri.conf.json` kollidierte (restriktivste Kombination blockierte `unsafe-eval` für Monaco Editor). HTML-CSP entfernt, `tauri.conf.json`-CSP um `unsafe-eval` ergänzt. |
| 71 | 2026-02-15 | v7.2.1 | improve | **Netzwerk-Monitor: Zwei-Stufen-UI** - Drei-Stufen-Umschalter (Basis/Erweitert/Experte) auf zwei Stufen vereinfacht: Normal und Experte. Normal zeigt alle nützlichen Informationen (Sparklines, Tracker-Badges, WiFi-Details, IP-Tabellen, Live-Feed). Experte zeigt zusätzlich technische Details (UDP-Verbindungen, DNS-Cache, Firewall-Buttons, Aufzeichnung). Alte Einstellungen (basis/erweitert) werden automatisch zu "Normal" migriert. |
| 70 | 2026-02-15 | v7.2.1 | feature | **Netzwerk-Monitor: 9 Optimierungen** - Umfassende Erweiterung des Netzwerk-Moduls: (1) Persistenter IP-Cache: Aufgelöste IP-Informationen werden in %APPDATA% gespeichert und beim nächsten Start sofort geladen (TTL: 7 Tage, max. 2000 Einträge). (2) Lokale OUI-Datenbank: Hersteller-Erkennung nutzt jetzt eine lokale IEEE-Datenbank mit 38.902 Einträgen statt einer externen API — Netzwerk-Scan geht von 15-20s auf unter 1s für Hersteller-Lookup, funktioniert offline. (3) Bandbreiten-Sparklines: Mini-Diagramme in jeder Adapter-Karte zeigen den Bandbreitenverlauf der letzten 5 Minuten (Chart.js, Empfangen grün, Gesendet blau). (4) UDP-Verbindungen: Neben TCP werden jetzt auch UDP-Endpunkte angezeigt — eigene Metrik-Karte und Protokoll-Badges (TCP/UDP) an jeder Verbindung. (5) WiFi-Details: WLAN-Signalstärke, SSID, Kanal, Frequenzband, Authentifizierung und Verschlüsselung in der Bandbreiten-Ansicht. Signalbalken mit Farbverlauf (rot/gelb/grün). (6) DNS-Cache-Viewer: Aufklappbare Sektion zeigt alle kürzlich aufgelösten Domains mit IP, TTL und Typ. Button zum Leeren des DNS-Caches. (7) Bandbreiten-Daten in Snapshots: Historische Snapshots enthalten jetzt auch die Bandbreitenraten pro Adapter. CSV-Export um Bandbreite und UDP erweitert. (8) Drei-Stufen-UI: Umschalter Basis/Erweitert/Experte im Header — Basis zeigt nur Metrikkarten und Adapter, Erweitert zeigt Sparklines, WiFi, Tracker-Badges und IP-Tabellen, Experte zeigt zusätzlich UDP, DNS-Cache, Aufzeichnungs-Controls und Firewall-Buttons. Einstellung wird in Preferences gespeichert. (9) Npcap-Code entfernt: Ungenutzter npcap-Code aus Backend, IPC und Preload entfernt (~105 Zeilen). Zusätzlich: isPrivateIP-Logik zwischen Frontend und Backend synchronisiert (127.*-Range statt nur 127.0.0.1). |
| 69 | 2026-02-15 | v7.2.1 | improve | **Netzwerk-Monitor: npcap-Leiste entfernt, Tabellen-Hover, WCAG-Fix** - Fünf Verbesserungen: (1) Npcap-Info-Leiste im Live-Feed komplett entfernt — zeigte eine Installations-Aufforderung für ein Feature das noch nicht existiert (Paketerfassung). Backend-Funktionen bleiben für spätere Integration erhalten. (2) Tabellen-Hover-Effekt: Beim Überfahren einer Zeile mit der Maus wird diese dezent hervorgehoben — gilt für Verbindungen-Tab und Live-Feed-Tabelle. (3) WCAG-Fix: Firmennamen in der Verbindungsliste waren in Lila (accent-text) dargestellt und auf dem dunklen Hintergrund schwer lesbar — jetzt in Hellgrau (text-secondary) für besseren Kontrast. Firmen-Spalte von 200px auf 300px verbreitert, ISP-Spalte von 150px auf 200px. (4) Suchfeld-Debouncing: Eingabe wird 250ms verzögert verarbeitet — verhindert Lag bei vielen Verbindungen. (5) Keyboard-Accessibility: Metrikkarten sind jetzt per Tab-Taste erreichbar und per Enter/Leertaste aktivierbar (tabindex + role="button" + Focus-Outline). |
| 68 | 2026-02-15 | v7.2.1 | fix | **Live-Feed: Loopback-Filter, Initial-Dump-Fix, Tabelle volle Breite** - Drei Anzeigeprobleme behoben: (1) Loopback/lokale Verbindungen (127.0.0.1, 0.0.0.0) und "Idle"-Prozesse werden jetzt automatisch herausgefiltert. (2) Beim ersten Öffnen wurden alle bestehenden Verbindungen als "NEU" angezeigt — jetzt wird erst eine Basislinie erstellt, danach werden nur echte Änderungen gemeldet. (3) Die Tabelle füllte nicht die volle Breite aus (leerer blauer Raum rechts), weil alle Spalten auf maximal 200px begrenzt waren — jetzt nutzt die Tabelle die gesamte Breite mit intelligenter Spaltenverteilung (Firma-Spalte am breitesten). Lokale IP-Adressen zeigen "Lokal" in der Firma-Spalte statt leerem Feld. |
| 67 | 2026-02-15 | v7.2.1 | improve | **Netzwerk-Monitor UX-Upgrade** - Einheiten vereinheitlicht: Adapter-Geschwindigkeit immer als Mbit/s oder Gbit/s, Durchsatz als B/s, KB/s oder MB/s. Metrikkarten (Verbindungen, Aktiv, Lauschend, Remote-IPs, Firmen, Tracker, Hochrisiko) sind jetzt klickbar und filtern die Prozessliste direkt. Filter-Indikator zeigt den aktiven Filter mit Zurücksetzen-Button. Npcap: Website-Link durch "Npcap jetzt installieren" Button ersetzt — lädt den Installer automatisch herunter und startet die Installation (UAC-Bestätigung nötig). Farbige State-Pills: Established=grün, Listen=lila, TimeWait/CloseWait=gedämpft. Port-Tooltips für bekannte Protokolle (HTTP, HTTPS, DNS, SSH, RDP etc.). Firmen-Tooltip zeigt alle Firmen bei Hover statt nur die ersten 3. Gesamt-Bytes als separate Zeile unter der Live-Geschwindigkeit. |
| 66 | 2026-02-15 | v7.2.1 | feature | **npcap-Erkennung** - Der Live-Feed Tab zeigt jetzt eine Info-Leiste die den npcap-Status anzeigt: (1) Kein npcap installiert: Lila Hinweis mit Link zu npcap.com/download für erweiterte Paketanalyse (DNS-Abfragen, HTTP-Requests, Protokolle). (2) npcap installiert, kein Admin: Gelber Hinweis mit "Als Administrator starten" Button für Admin-Elevation. (3) npcap + Admin: Grüner Hinweis dass die Paketerfassung verfügbar ist. Die Erkennung prüft ob C:\Windows\System32\Npcap\wpcap.dll existiert. Per Puppeteer-Screenshot verifiziert: Install-Hinweis korrekt sichtbar mit klickbarem Link. |
| 65 | 2026-02-15 | v7.2.1 | feature | **Netzwerk-Aufzeichnung** - Neues Aufzeichnungs-Feature im Live-Feed Tab: "Aufzeichnung starten" Button (rot) startet eine Aufnahme, die alle Verbindungsänderungen (NEU/GESCHLOSSEN/GEÄNDERT) als JSONL-Datei im Verzeichnis %APPDATA%/speicher-analyse/netzwerk-aufzeichnungen/ speichert. Während der Aufnahme zeigt ein pulsierender roter Indikator die Dauer und Anzahl der Events an. "Aufzeichnung stoppen" beendet die Aufnahme und speichert eine Footer-Zeile mit Zusammenfassung. Unterhalb des Live-Feeds erscheint eine Tabelle mit allen gespeicherten Aufzeichnungen (Datum, Dauer, Ereignisse, Grösse) inkl. Löschen-Button und "Ordner öffnen" Link. Neues Backend-Modul main/network-recording.js mit 7 Funktionen und 7 IPC-Handlern. Per Puppeteer-Screenshot verifiziert: Start-Button sichtbar, Rec-Indikator mit Timer "00:08 (19 Events)", gespeicherte Aufzeichnung "4.4 KB" in der Liste. |
| 64 | 2026-02-15 | v7.2.1 | feature | **Live-Feed Tab (Wireshark-light)** - Neuer "Live-Feed" Tab im Netzwerk-Monitor zeigt Verbindungsänderungen in Echtzeit als scrollbaren Event-Stream an. Backend-Connection-Diff vergleicht alle 3 Sekunden den aktuellen Verbindungssnapshot mit dem vorherigen und erkennt drei Event-Typen: NEU (grün, neue Verbindung aufgebaut), GESCHLOSSEN (rot, Verbindung beendet) und GEÄNDERT (gelb, Status-Wechsel). Jeder Event zeigt Zeitstempel, Prozessname, Remote-IP, Port mit Protokoll-Label (HTTP, HTTPS, SSH, DNS etc.), Firma und Land. Pause-Button stoppt die automatische Aktualisierung, Leeren-Button löscht den Feed. Rolling-Buffer speichert maximal 500 Events. Statistik-Leiste zeigt Gesamt-Events, neue und geschlossene Verbindungen. Per Puppeteer-Screenshot verifiziert: 15 Events (6 neue, 9 geschlossene) mit farbcodierten Badges, Prozessnamen und IP-Adressen sichtbar. |
| 63 | 2026-02-15 | v7.2.1 | feature | **Netzwerk-Tabs konsolidiert** - 4 Tabs auf 3 reduziert: "Übersicht" und "Verbindungen" zu einem Tab "Verbindungen" zusammengeführt (Metrikkarten + Bandbreite + Prozessgruppen in einer Ansicht). "Sicherheitsübersicht" entfernt (redundant zum Sidebar-Eintrag "Sicherheits-Check"). "Verlauf" entfernt (wird durch Aufzeichnungsfunktion im Live-Feed ersetzt). Per Puppeteer-Screenshot verifiziert: 5 Karten, 5 Adapter, 22 Prozessgruppen in einer Ansicht. |
| 62 | 2026-02-15 | v7.2.1 | feature | **Auto-Live Netzwerk-Monitor** - Bandbreite aktualisiert sich jetzt automatisch wenn der Netzwerk-Tab sichtbar ist und stoppt beim Verlassen. Echtzeit-Toggle komplett entfernt — kein manuelles Aktivieren mehr nötig. Live-Indikator erscheint automatisch. Tab-Lifecycle über activate()/deactivate() gesteuert, wird von switchToTab() in app.js aufgerufen. Per Puppeteer-Screenshot verifiziert: Ethernet zeigt 2.2 KB/s, Live-Indikator pulsiert, kein Toggle sichtbar. |
| 61 | 2026-02-15 | v7.2.1 | fix | **Echtzeit-Funktion repariert** - Die Echtzeit-Bandbreitenanzeige zeigte dauerhaft "0 KB/s" und reagierte nicht. Drei Ursachen behoben: (1) Beim Aktivieren des Echtzeit-Toggles wurde kein sofortiger Datenabruf gestartet — der erste Wert kam erst nach 15+ Sekunden (5s Intervall + 10s PowerShell). Jetzt wird sofort ein leichtgewichtiger Bandwidth-Abruf gestartet (~2-3s). (2) Das Echtzeit-Polling nutzte den schweren kombinierten getPollingData()-Aufruf (Verbindungen + Zusammenfassung + Bandbreite in einem PowerShell-Aufruf, 10+ Sekunden). Ersetzt durch reines getBandwidth()-Polling, das nur Adapter-Statistiken abfragt (~2-3s). (3) Der Live-Indikator erscheint sofort beim Aktivieren, nicht erst nach dem ersten Datenabruf. Per Puppeteer-Screenshot verifiziert: Ethernet zeigt "75.6 KB/s" empfangen und "4.9 KB/s" gesendet (grün), Werte aktualisieren sich alle 5 Sekunden, Live-Indikator pulsiert. |

---

## Lessons Learned

Siehe auch: [`archiv/aenderungsprotokoll_v7.0-v7.2.md`](archiv/aenderungsprotokoll_v7.0-v7.2.md) (3 Lessons)
Siehe auch: [`archiv/aenderungsprotokoll_v7.3-v7.5.md`](archiv/aenderungsprotokoll_v7.3-v7.5.md)

### #9: Migration = JEDE Funktion prüfen, nicht nur die offensichtlich kaputten (2026-02-16)

**Problem:** Nach der Electron→Tauri v2 Migration wurden 31 Funktionen als Stubs belassen (leere Arrays, `null`, `{ stub: true }`). Die KI hat nur die offensichtlich sichtbaren Probleme (Netzwerk-Scan) repariert und die restlichen 31 Stubs ignoriert. Der User musste mehrmals darauf hinweisen, dass Funktionen fehlen — obwohl eine systematische Prüfung ALLER Commands beim ersten Mal nötig gewesen wäre.

**Ursache:** Isolierte statt ganzheitliche Analyse. Die KI hat sich auf ein Symptom konzentriert (Netzwerk zeigt keine Daten) statt die gesamte Codebasis systematisch zu prüfen (welche Commands sind Stubs? welche geben Fake-Daten zurück?).

**Lösung:** Nach JEDER Migration/Rewrite: Systematisch JEDEN Command in commands.rs durchgehen und per Grep nach Stub-Patterns suchen (`stub: true`, `json!([])`, `json!(null)`, `"not implemented"`). Checkliste abarbeiten, nicht nur die ersten sichtbaren Fehler fixen.

**Lehre:**
- Migration ist NICHT fertig wenn die App startet. Migration ist fertig wenn JEDE Funktion echte Daten liefert.
- NIEMALS isoliert analysieren. IMMER die gesamte Codebasis prüfen.
- Ein Stub der `[]` oder `null` zurückgibt ist genauso kaputt wie ein Kompilierungsfehler — er ist nur schwerer zu sehen.
- Der User muss NIEMALS zweimal auf dasselbe Problem hinweisen. Beim ersten Hinweis: ganzheitlich prüfen, nicht nur den gemeldeten Fall fixen.
- Grep-Patterns für Stub-Erkennung: `stub: true`, `json!([])`, `json!(null)`, `"not implemented"`, `"not yet"`, `todo!()`, `unimplemented!()`

---

### #4: node-pty + Electron: Native Module Builds (2026-02-10)

**Problem:** node-pty@1.1.0 brauchte winpty (GetCommitHash.bat Fehler). node-pty@1.2.0-beta.11 (ConPTY-only) scheiterte an Spectre-Mitigation.

**Lösung:** `scripts/rebuild-pty.js` patcht binding.gyp automatisch vor electron-rebuild. In package.json als postinstall registriert.

**Lehre:** Native Electron-Module können plattformspezifische Build-Probleme haben. Automatische Patches als postinstall-Scripts sind robuster als manuelle Fixes.

---

### #5: Session-Save im before-quit muss synchron sein (2026-02-10)

**Problem:** Electrons `before-quit` Event wartet NICHT auf async Operationen. `await session.saveSession()` wird nie fertig.

**Lösung:** Synchrone Variante: `zlib.gzipSync()` + `fs.writeFileSync()` direkt im before-quit Handler. Die async Variante wird nur für after-scan und manuelles Speichern verwendet.

**Lehre:** Electron Lifecycle-Events (before-quit, will-quit) sind synchron. Für Cleanup-Code immer synchrone APIs verwenden.

---

### #6: Chromium file:// blockiert Module Workers (2026-02-10)

**Problem:** pdf.js Worker-Datei ist `.mjs` → pdf.js erstellt `new Worker(url, { type: 'module' })`. Chromium blockiert Module Workers von `file://` URLs (null origin, CORS-Check fehlschlägt).

**Lösung:** Worker-Script per `fetch()` laden, `export{}` Statement entfernen (ungültig in Classic Worker), als `Blob` + `URL.createObjectURL()` laden. CSP erlaubt `worker-src blob:`.

**Lehre:** In Electron (file:// Protokoll) niemals Module Workers (.mjs) verwenden. Immer Classic Workers via Blob-URL oder .js-Dateien nutzen.

---

### #7: Node.js Buffer.buffer enthält Pool-Daten (2026-02-10)

**Problem:** `fs.readFile()` gibt Buffer zurück. `buffer.buffer` ist der unterliegende ArrayBuffer, der bei kleinen Dateien den GESAMTEN Pool enthält (8KB+). `new Uint8Array(buffer.buffer)` enthält dann Müll-Daten.

**Lösung:** `buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength)` für sauberen ArrayBuffer.

**Lehre:** NIEMALS `buffer.buffer` direkt über IPC senden. Immer `.slice()` für einen sauberen ArrayBuffer verwenden.

---

### #8: Electron Admin-Elevation: Single-Instance Lock Race Condition (2026-02-11)

**Problem:** `Start-Process -Verb RunAs` startet den neuen Prozess, PowerShell gibt Return, und `app.quit()` wird aufgerufen. Aber `app.quit()` ist ASYNC — bis die alte Instanz den Lock freigibt, hat die neue Instanz bereits `requestSingleInstanceLock()` aufgerufen, `false` bekommen, und sich sofort beendet. Ergebnis: App schließt sich und nichts passiert.

**Lösung:** 4 Fixes zusammen:
1. `app.releaseSingleInstanceLock()` EXPLIZIT VOR dem Spawn der neuen Instanz aufrufen (Electron API seit v15)
2. `app.exit(0)` statt `app.quit()` — sofortiger Exit ohne async Event-Queue
3. `execFileAsync` statt `execAsync` — bypassed cmd.exe komplett (keine Double-Quote-Nesting-Probleme)
4. `app._isElevating` Flag — verhindert dass Window-Close/Tray/window-all-closed während der UAC-Wartezeit `app.quit()` aufrufen

**Lehre:**
- `app.quit()` ist ASYNC und feuert Events (before-quit, will-quit, window-all-closed). Für Elevation immer `app.exit(0)` verwenden.
- `requestSingleInstanceLock()` muss EXPLIZIT mit `releaseSingleInstanceLock()` freigegeben werden bevor die neue Instanz startet. Sich auf `app.quit()` verlassen funktioniert nicht (Race Condition).
- `exec()` geht durch `cmd.exe /c "..."` — fragile Verschachtelung bei PowerShell-Befehlen. `execFile()` spawnt direkt.
- Während Elevation (UAC-Wartezeit bis 120s) muss ALLES was `app.quit()` aufrufen könnte blockiert werden: Window-Close, window-all-closed, Tray-Menü. Sonst wird `before-quit` gefeuert, Cleanup-Code räumt die scans-Map ab, und die Elevation-Daten sind weg.
