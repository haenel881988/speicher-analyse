# Änderungsprotokoll

> **Regel:** Maximal 30 Einträge. Bei Überschreitung die ältesten in `archiv/` verschieben (Dateiname: `aenderungsprotokoll_<version>.md`).

Archiv: [`archiv/aenderungsprotokoll_v7.0-v7.2.md`](archiv/aenderungsprotokoll_v7.0-v7.2.md) (30 Einträge, v7.0–v7.2)
Archiv: [`archiv/aenderungsprotokoll_v7.3-v7.5.md`](archiv/aenderungsprotokoll_v7.3-v7.5.md) (15 Einträge, v7.3–v7.5)
Archiv: [`archiv/aenderungsprotokoll_v7.3-v8.0.md`](archiv/aenderungsprotokoll_v7.3-v8.0.md) (15 Einträge, v7.3–v8.0)
Archiv: [`archiv/aenderungsprotokoll_v7.2.1-v7.3.md`](archiv/aenderungsprotokoll_v7.2.1-v7.3.md) (15 Einträge, v7.2.1–v7.3)
Archiv: [`archiv/aenderungsprotokoll_v7.2.1-n31-45.md`](archiv/aenderungsprotokoll_v7.2.1-n31-45.md) (15 Einträge, #31–#45)
Archiv: [`archiv/aenderungsprotokoll_n46-60.md`](archiv/aenderungsprotokoll_n46-60.md) (15 Einträge, #46–#60)

---

| # | Datum | Version | Typ | Beschreibung |
|---|-------|---------|-----|-------------|
| 76 | 2026-02-16 | v7.2.1 | feature | **Netzwerk-Informationen wiederhergestellt** - Fehlende Netzwerk-Daten nach der Tauri v2 Migration komplett wiederhergestellt: (1) Neues OUI-Modul (`oui.rs`) mit ~220 MAC-Herstellerpräfixen für Offline-Herstellererkennung (Apple, Samsung, TP-Link, Netgear, etc.). (2) Aktiver Netzwerk-Scan (`scan_network_active`) um paralleles Port-Scanning (11 Ports) und Rust-seitige Geräteklassifizierung erweitert — jedes Gerät erhält Hersteller, Gerätetyp, Label und Icon basierend auf offenen Ports, Hostname und MAC-Adresse. (3) IP-Auflösung (`resolve_ips`) vollständig implementiert — parallele Reverse-DNS-Auflösung mit Zuordnung zu ~50 Firmen (Google, Microsoft, Apple, Meta, AWS, Deutsche Telekom, Vodafone, etc.) und Tracker-Erkennung. (4) Polling-Daten (`get_polling_data`) mit Firmen-Zuordnung über einen Hintergrund-Cache — aufgelöste IPs werden gecacht und bei jedem Poll-Zyklus in die Prozessgruppen eingebettet. (5) Passiver Scan (`scan_local_network`) um OUI-Herstellerzuordnung und korrekte Feldnamen erweitert. (6) Explorer: Silent-Catch bei Ordnergrößen durch geloggte Warnung ersetzt. |
| 75 | 2026-02-16 | v7.2.1 | feature | **Dev-Logging mit tracing** - Umfassendes Logging-System für die Entwicklerversion implementiert: Rust-Backend nutzt das `tracing`-Crate mit `tracing-subscriber` (nur aktiv im Debug-Build via `cfg!(debug_assertions)`). PowerShell-Aufrufe werden mit Script-Preview, Ausführungsdauer und Fehlerdetails geloggt (ps.rs). Kritische Commands (Scan, Löschung, Service-Steuerung, Firewall, Privacy, Registry, Bloatware, Optimierung, Netzwerk-Scan) loggen ihre Ausführung mit Parametern. Neuer `log_frontend`-Command ermöglicht dem Frontend, Fehler ins Backend-Log zu senden. Globale Error-Handler (`window.onerror`, `unhandledrejection`) in app.js fangen unbehandelte Frontend-Fehler ab und leiten sie an das Backend weiter. Log-Level steuerbar via `RUST_LOG` Umgebungsvariable (Standard: `speicher_analyse_lib=debug,warn`). Logs werden in `docs/logs/` geschrieben (Konsole + Datei gleichzeitig). |
| 74 | 2026-02-16 | v7.2.1 | fix | **Netzwerk-Scan repariert** - Zwei Wurzelursachen behoben: (1) Datenformat-Mismatch — das Backend gab ein flaches Array zurück, aber das Frontend erwartete ein Objekt mit `{devices, subnet, localIP}`. Der Zugriff auf `.devices.length` schlug fehl und der Scan zeigte "fehlgeschlagen" obwohl die Daten korrekt ermittelt wurden. (2) Sequenzielle DNS-Auflösung — `GetHostEntry()` blockierte pro Host 5+ Sekunden, was bei mehreren Geräten den 30-Sekunden-Timeout überschritt. Ersetzt durch parallele `GetHostEntryAsync()` mit `WaitAll(5000/8000)`. Zusätzlich: Scan-Ergebnis wird jetzt im Backend gecacht (`LAST_NETWORK_SCAN`), damit `get_last_network_scan()` das letzte Ergebnis nach Page-Reloads zurückgeben kann. Router/Gateway und eigener PC werden automatisch erkannt. Per CDP-Test verifiziert: 10 Geräte im Netzwerk gefunden, gruppiert nach Typ, Toast "10 Geräte gefunden" sichtbar. |
| 73 | 2026-02-16 | v7.2.1 | refactor | **Electron-Bereinigung** - Komplette Entfernung aller Electron-Fragmente nach der Tauri v2 Migration: `main/` Verzeichnis mit 52 Electron-Dateien geloescht (main.js, preload.js, ipc-handlers.js etc.), `launch.js` und `scripts/rebuild-pty.js` geloescht, `package-lock.json` neu generiert (561 auf 94 Pakete, 0 Electron-Dependencies), veraltete Electron-Kommentare in 7 Dateien aktualisiert (tauri-bridge.js, preview.js, index.html, commands.rs, wcag-gate.js, .gitignore), Skills `/test-issue` und `/visual-verify` um WebView2-CDP-Anleitung ergaenzt (WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS Umgebungsvariable). |
| 72 | 2026-02-16 | v7.2.1 | fix | **Fehlende Tauri v2 Capabilities hinzugefügt** - Scan-Events (Progress/Complete/Error) erreichten das Frontend nicht, weil die Datei `src-tauri/capabilities/default.json` fehlte. Ohne `core:event:default` blockierte Tauri v2 alle `event.listen()`-Aufrufe mit dem Fehler "event.listen not allowed". Dadurch startete der Scan zwar im Backend (walkdir lief korrekt, `app.emit()` gab `Ok(())` zurück), aber das Frontend empfing keine Events — die Fortschrittsanzeige blieb leer und der Scan schien nie fertig zu werden. Fix: `capabilities/default.json` mit `core:default`, `shell:allow-open`, `dialog:default`, `clipboard-manager:allow-write-text` erstellt. Zusätzlich: CSP-Duplikat behoben — HTML hatte eine eigene CSP Meta-Tag die mit der CSP aus `tauri.conf.json` kollidierte (restriktivste Kombination blockierte `unsafe-eval` für Monaco Editor). HTML-CSP entfernt, `tauri.conf.json`-CSP um `unsafe-eval` ergänzt. |
| 71 | 2026-02-15 | v7.2.1 | improve | **Netzwerk-Monitor: Zwei-Stufen-UI** - Drei-Stufen-Umschalter (Basis/Erweitert/Experte) auf zwei Stufen vereinfacht: Normal und Experte. Normal zeigt alle nützlichen Informationen (Sparklines, Tracker-Badges, WiFi-Details, IP-Tabellen, Live-Feed). Experte zeigt zusätzlich technische Details (UDP-Verbindungen, DNS-Cache, Firewall-Buttons, Aufzeichnung). Alte Einstellungen (basis/erweitert) werden automatisch zu "Normal" migriert. |
| 70 | 2026-02-15 | v7.2.1 | feature | **Netzwerk-Monitor: 9 Optimierungen** - Umfassende Erweiterung des Netzwerk-Moduls: (1) Persistenter IP-Cache: Aufgelöste IP-Informationen werden in %APPDATA% gespeichert und beim nächsten Start sofort geladen (TTL: 7 Tage, max. 2000 Einträge). (2) Lokale OUI-Datenbank: Hersteller-Erkennung nutzt jetzt eine lokale IEEE-Datenbank mit 38.902 Einträgen statt einer externen API — Netzwerk-Scan geht von 15-20s auf unter 1s für Hersteller-Lookup, funktioniert offline. (3) Bandbreiten-Sparklines: Mini-Diagramme in jeder Adapter-Karte zeigen den Bandbreitenverlauf der letzten 5 Minuten (Chart.js, Empfangen grün, Gesendet blau). (4) UDP-Verbindungen: Neben TCP werden jetzt auch UDP-Endpunkte angezeigt — eigene Metrik-Karte und Protokoll-Badges (TCP/UDP) an jeder Verbindung. (5) WiFi-Details: WLAN-Signalstärke, SSID, Kanal, Frequenzband, Authentifizierung und Verschlüsselung in der Bandbreiten-Ansicht. Signalbalken mit Farbverlauf (rot/gelb/grün). (6) DNS-Cache-Viewer: Aufklappbare Sektion zeigt alle kürzlich aufgelösten Domains mit IP, TTL und Typ. Button zum Leeren des DNS-Caches. (7) Bandbreiten-Daten in Snapshots: Historische Snapshots enthalten jetzt auch die Bandbreitenraten pro Adapter. CSV-Export um Bandbreite und UDP erweitert. (8) Drei-Stufen-UI: Umschalter Basis/Erweitert/Experte im Header — Basis zeigt nur Metrikkarten und Adapter, Erweitert zeigt Sparklines, WiFi, Tracker-Badges und IP-Tabellen, Experte zeigt zusätzlich UDP, DNS-Cache, Aufzeichnungs-Controls und Firewall-Buttons. Einstellung wird in Preferences gespeichert. (9) Npcap-Code entfernt: Ungenutzter npcap-Code aus Backend, IPC und Preload entfernt (~105 Zeilen). Zusätzlich: isPrivateIP-Logik zwischen Frontend und Backend synchronisiert (127.*-Range statt nur 127.0.0.1). |
| 69 | 2026-02-15 | v7.2.1 | improve | **Netzwerk-Monitor: npcap-Leiste entfernt, Tabellen-Hover, WCAG-Fix** - Fünf Verbesserungen: (1) Npcap-Info-Leiste im Live-Feed komplett entfernt — zeigte eine Installations-Aufforderung für ein Feature das noch nicht existiert (Paketerfassung). Backend-Funktionen bleiben für spätere Integration erhalten. (2) Tabellen-Hover-Effekt: Beim Überfahren einer Zeile mit der Maus wird diese dezent hervorgehoben — gilt für Verbindungen-Tab und Live-Feed-Tabelle. (3) WCAG-Fix: Firmennamen in der Verbindungsliste waren in Lila (accent-text) dargestellt und auf dem dunklen Hintergrund schwer lesbar — jetzt in Hellgrau (text-secondary) für besseren Kontrast. Firmen-Spalte von 200px auf 300px verbreitert, ISP-Spalte von 150px auf 200px. (4) Suchfeld-Debouncing: Eingabe wird 250ms verzögert verarbeitet — verhindert Lag bei vielen Verbindungen. (5) Keyboard-Accessibility: Metrikkarten sind jetzt per Tab-Taste erreichbar und per Enter/Leertaste aktivierbar (tabindex + role="button" + Focus-Outline). |
| 68 | 2026-02-15 | v7.2.1 | fix | **Live-Feed: Loopback-Filter, Initial-Dump-Fix, Tabelle volle Breite** - Drei Anzeigeprobleme behoben: (1) Loopback/lokale Verbindungen (127.0.0.1, 0.0.0.0) und "Idle"-Prozesse werden jetzt automatisch herausgefiltert. (2) Beim ersten Öffnen wurden alle bestehenden Verbindungen als "NEU" angezeigt — jetzt wird erst eine Basislinie erstellt, danach werden nur echte Änderungen gemeldet. (3) Die Tabelle füllte nicht die volle Breite aus (leerer blauer Raum rechts), weil alle Spalten auf maximal 200px begrenzt waren — jetzt nutzt die Tabelle die gesamte Breite mit intelligenter Spaltenverteilung (Firma-Spalte am breitesten). Lokale IP-Adressen zeigen "Lokal" in der Firma-Spalte statt leerem Feld. |
| 67 | 2026-02-15 | v7.2.1 | improve | **Netzwerk-Monitor UX-Upgrade** - Einheiten vereinheitlicht: Adapter-Geschwindigkeit immer als Mbit/s oder Gbit/s, Durchsatz als B/s, KB/s oder MB/s. Metrikkarten (Verbindungen, Aktiv, Lauschend, Remote-IPs, Firmen, Tracker, Hochrisiko) sind jetzt klickbar und filtern die Prozessliste direkt. Filter-Indikator zeigt den aktiven Filter mit Zurücksetzen-Button. Npcap: Website-Link durch "Npcap jetzt installieren" Button ersetzt — lädt den Installer automatisch herunter und startet die Installation (UAC-Bestätigung nötig). Farbige State-Pills: Established=grün, Listen=lila, TimeWait/CloseWait=gedämpft. Port-Tooltips für bekannte Protokolle (HTTP, HTTPS, DNS, SSH, RDP etc.). Firmen-Tooltip zeigt alle Firmen bei Hover statt nur die ersten 3. Gesamt-Bytes als separate Zeile unter der Live-Geschwindigkeit. |
| 66 | 2026-02-15 | v7.2.1 | feature | **npcap-Erkennung** - Der Live-Feed Tab zeigt jetzt eine Info-Leiste die den npcap-Status anzeigt: (1) Kein npcap installiert: Lila Hinweis mit Link zu npcap.com/download für erweiterte Paketanalyse (DNS-Abfragen, HTTP-Requests, Protokolle). (2) npcap installiert, kein Admin: Gelber Hinweis mit "Als Administrator starten" Button für Admin-Elevation. (3) npcap + Admin: Grüner Hinweis dass die Paketerfassung verfügbar ist. Die Erkennung prüft ob C:\Windows\System32\Npcap\wpcap.dll existiert. Per Puppeteer-Screenshot verifiziert: Install-Hinweis korrekt sichtbar mit klickbarem Link. |
| 65 | 2026-02-15 | v7.2.1 | feature | **Netzwerk-Aufzeichnung** - Neues Aufzeichnungs-Feature im Live-Feed Tab: "Aufzeichnung starten" Button (rot) startet eine Aufnahme, die alle Verbindungsänderungen (NEU/GESCHLOSSEN/GEÄNDERT) als JSONL-Datei im Verzeichnis %APPDATA%/speicher-analyse/netzwerk-aufzeichnungen/ speichert. Während der Aufnahme zeigt ein pulsierender roter Indikator die Dauer und Anzahl der Events an. "Aufzeichnung stoppen" beendet die Aufnahme und speichert eine Footer-Zeile mit Zusammenfassung. Unterhalb des Live-Feeds erscheint eine Tabelle mit allen gespeicherten Aufzeichnungen (Datum, Dauer, Ereignisse, Grösse) inkl. Löschen-Button und "Ordner öffnen" Link. Neues Backend-Modul main/network-recording.js mit 7 Funktionen und 7 IPC-Handlern. Per Puppeteer-Screenshot verifiziert: Start-Button sichtbar, Rec-Indikator mit Timer "00:08 (19 Events)", gespeicherte Aufzeichnung "4.4 KB" in der Liste. |
| 64 | 2026-02-15 | v7.2.1 | feature | **Live-Feed Tab (Wireshark-light)** - Neuer "Live-Feed" Tab im Netzwerk-Monitor zeigt Verbindungsänderungen in Echtzeit als scrollbaren Event-Stream an. Backend-Connection-Diff vergleicht alle 3 Sekunden den aktuellen Verbindungssnapshot mit dem vorherigen und erkennt drei Event-Typen: NEU (grün, neue Verbindung aufgebaut), GESCHLOSSEN (rot, Verbindung beendet) und GEÄNDERT (gelb, Status-Wechsel). Jeder Event zeigt Zeitstempel, Prozessname, Remote-IP, Port mit Protokoll-Label (HTTP, HTTPS, SSH, DNS etc.), Firma und Land. Pause-Button stoppt die automatische Aktualisierung, Leeren-Button löscht den Feed. Rolling-Buffer speichert maximal 500 Events. Statistik-Leiste zeigt Gesamt-Events, neue und geschlossene Verbindungen. Per Puppeteer-Screenshot verifiziert: 15 Events (6 neue, 9 geschlossene) mit farbcodierten Badges, Prozessnamen und IP-Adressen sichtbar. |
| 63 | 2026-02-15 | v7.2.1 | feature | **Netzwerk-Tabs konsolidiert** - 4 Tabs auf 3 reduziert: "Übersicht" und "Verbindungen" zu einem Tab "Verbindungen" zusammengeführt (Metrikkarten + Bandbreite + Prozessgruppen in einer Ansicht). "Sicherheitsübersicht" entfernt (redundant zum Sidebar-Eintrag "Sicherheits-Check"). "Verlauf" entfernt (wird durch Aufzeichnungsfunktion im Live-Feed ersetzt). Per Puppeteer-Screenshot verifiziert: 5 Karten, 5 Adapter, 22 Prozessgruppen in einer Ansicht. |
| 62 | 2026-02-15 | v7.2.1 | feature | **Auto-Live Netzwerk-Monitor** - Bandbreite aktualisiert sich jetzt automatisch wenn der Netzwerk-Tab sichtbar ist und stoppt beim Verlassen. Echtzeit-Toggle komplett entfernt — kein manuelles Aktivieren mehr nötig. Live-Indikator erscheint automatisch. Tab-Lifecycle über activate()/deactivate() gesteuert, wird von switchToTab() in app.js aufgerufen. Per Puppeteer-Screenshot verifiziert: Ethernet zeigt 2.2 KB/s, Live-Indikator pulsiert, kein Toggle sichtbar. |
| 61 | 2026-02-15 | v7.2.1 | fix | **Echtzeit-Funktion repariert** - Die Echtzeit-Bandbreitenanzeige zeigte dauerhaft "0 KB/s" und reagierte nicht. Drei Ursachen behoben: (1) Beim Aktivieren des Echtzeit-Toggles wurde kein sofortiger Datenabruf gestartet — der erste Wert kam erst nach 15+ Sekunden (5s Intervall + 10s PowerShell). Jetzt wird sofort ein leichtgewichtiger Bandwidth-Abruf gestartet (~2-3s). (2) Das Echtzeit-Polling nutzte den schweren kombinierten getPollingData()-Aufruf (Verbindungen + Zusammenfassung + Bandbreite in einem PowerShell-Aufruf, 10+ Sekunden). Ersetzt durch reines getBandwidth()-Polling, das nur Adapter-Statistiken abfragt (~2-3s). (3) Der Live-Indikator erscheint sofort beim Aktivieren, nicht erst nach dem ersten Datenabruf. Per Puppeteer-Screenshot verifiziert: Ethernet zeigt "75.6 KB/s" empfangen und "4.9 KB/s" gesendet (grün), Werte aktualisieren sich alle 5 Sekunden, Live-Indikator pulsiert. |

---

## Lessons Learned

Siehe auch: [`archiv/aenderungsprotokoll_v7.0-v7.2.md`](archiv/aenderungsprotokoll_v7.0-v7.2.md) (3 Lessons)
Siehe auch: [`archiv/aenderungsprotokoll_v7.3-v7.5.md`](archiv/aenderungsprotokoll_v7.3-v7.5.md)

### #4: node-pty + Electron: Native Module Builds (2026-02-10)

**Problem:** node-pty@1.1.0 brauchte winpty (GetCommitHash.bat Fehler). node-pty@1.2.0-beta.11 (ConPTY-only) scheiterte an Spectre-Mitigation.

**Lösung:** `scripts/rebuild-pty.js` patcht binding.gyp automatisch vor electron-rebuild. In package.json als postinstall registriert.

**Lehre:** Native Electron-Module können plattformspezifische Build-Probleme haben. Automatische Patches als postinstall-Scripts sind robuster als manuelle Fixes.

---

### #5: Session-Save im before-quit muss synchron sein (2026-02-10)

**Problem:** Electrons `before-quit` Event wartet NICHT auf async Operationen. `await session.saveSession()` wird nie fertig.

**Lösung:** Synchrone Variante: `zlib.gzipSync()` + `fs.writeFileSync()` direkt im before-quit Handler. Die async Variante wird nur für after-scan und manuelles Speichern verwendet.

**Lehre:** Electron Lifecycle-Events (before-quit, will-quit) sind synchron. Für Cleanup-Code immer synchrone APIs verwenden.

---

### #6: Chromium file:// blockiert Module Workers (2026-02-10)

**Problem:** pdf.js Worker-Datei ist `.mjs` → pdf.js erstellt `new Worker(url, { type: 'module' })`. Chromium blockiert Module Workers von `file://` URLs (null origin, CORS-Check fehlschlägt).

**Lösung:** Worker-Script per `fetch()` laden, `export{}` Statement entfernen (ungültig in Classic Worker), als `Blob` + `URL.createObjectURL()` laden. CSP erlaubt `worker-src blob:`.

**Lehre:** In Electron (file:// Protokoll) niemals Module Workers (.mjs) verwenden. Immer Classic Workers via Blob-URL oder .js-Dateien nutzen.

---

### #7: Node.js Buffer.buffer enthält Pool-Daten (2026-02-10)

**Problem:** `fs.readFile()` gibt Buffer zurück. `buffer.buffer` ist der unterliegende ArrayBuffer, der bei kleinen Dateien den GESAMTEN Pool enthält (8KB+). `new Uint8Array(buffer.buffer)` enthält dann Müll-Daten.

**Lösung:** `buffer.buffer.slice(buffer.byteOffset, buffer.byteOffset + buffer.byteLength)` für sauberen ArrayBuffer.

**Lehre:** NIEMALS `buffer.buffer` direkt über IPC senden. Immer `.slice()` für einen sauberen ArrayBuffer verwenden.

---

### #8: Electron Admin-Elevation: Single-Instance Lock Race Condition (2026-02-11)

**Problem:** `Start-Process -Verb RunAs` startet den neuen Prozess, PowerShell gibt Return, und `app.quit()` wird aufgerufen. Aber `app.quit()` ist ASYNC — bis die alte Instanz den Lock freigibt, hat die neue Instanz bereits `requestSingleInstanceLock()` aufgerufen, `false` bekommen, und sich sofort beendet. Ergebnis: App schließt sich und nichts passiert.

**Lösung:** 4 Fixes zusammen:
1. `app.releaseSingleInstanceLock()` EXPLIZIT VOR dem Spawn der neuen Instanz aufrufen (Electron API seit v15)
2. `app.exit(0)` statt `app.quit()` — sofortiger Exit ohne async Event-Queue
3. `execFileAsync` statt `execAsync` — bypassed cmd.exe komplett (keine Double-Quote-Nesting-Probleme)
4. `app._isElevating` Flag — verhindert dass Window-Close/Tray/window-all-closed während der UAC-Wartezeit `app.quit()` aufrufen

**Lehre:**
- `app.quit()` ist ASYNC und feuert Events (before-quit, will-quit, window-all-closed). Für Elevation immer `app.exit(0)` verwenden.
- `requestSingleInstanceLock()` muss EXPLIZIT mit `releaseSingleInstanceLock()` freigegeben werden bevor die neue Instanz startet. Sich auf `app.quit()` verlassen funktioniert nicht (Race Condition).
- `exec()` geht durch `cmd.exe /c "..."` — fragile Verschachtelung bei PowerShell-Befehlen. `execFile()` spawnt direkt.
- Während Elevation (UAC-Wartezeit bis 120s) muss ALLES was `app.quit()` aufrufen könnte blockiert werden: Window-Close, window-all-closed, Tray-Menü. Sonst wird `before-quit` gefeuert, Cleanup-Code räumt die scans-Map ab, und die Elevation-Daten sind weg.
